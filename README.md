# Automated Business Insights Agent

This project features an autonomous AI agent that empowers users to perform complex data analysis on business datasets using only natural language commands. The agent is exposed via a REST API, acting as an automated data analyst that translates plain English questions into executable Python (`pandas`) code to find and present insights.

## Core Features

-   **Natural Language Interface**: Users interact with the agent through a simple API endpoint, asking questions in plain English.
-   **Autonomous Code Generation**: The agent dynamically writes and executes Python `pandas` code to answer user queries, automating a traditionally manual data analysis workflow.
-   **Resilient Self-Correction**: Engineered with a robust loop that enables the agent to automatically debug its own generated code by analyzing Python tracebacks and retrying with a corrected approach.
-   **Schema-Aware Grounding**: The agent is initialized with the dataset's schema, which dramatically reduces code 'hallucinations' and ensures it uses valid column names and data types.
-   **API-First Design**: Built with FastAPI, the project is a scalable, self-documenting, and ready-to-deploy web service, not just a script.

## Project Structure

```
/automated-business-analyst/
|
â”œâ”€â”€ ðŸ“‚ data/
|   â””â”€â”€ sales_data_sample.csv  # Sample data for analysis
|
â”œâ”€â”€ ðŸ“„ .env.example             # Example environment file
â”œâ”€â”€ ðŸ“„ .gitignore
â”œâ”€â”€ ðŸ“„ agent.py                 # Core agent logic, prompt engineering, and self-correction loop
â”œâ”€â”€ ðŸ“„ main.py                  # FastAPI application entry point
â”œâ”€â”€ ðŸ“„ README.md
â”œâ”€â”€ ðŸ“„ requirements.txt         # Project dependencies
â””â”€â”€ ðŸ“„ tools.py                 # Defines the Python REPL tool for the agent
```

## Setup & Installation

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/your-username/automated-business-analyst.git
    cd automated-business-analyst
    ```

2.  **Create a virtual environment and activate it:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows, use `venv\Scripts\activate`
    ```

3.  **Install the required dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Set up your environment variables:**
    -   Rename the `.env.example` file to `.env`.
    -   Open the `.env` file and add your OpenAI API key:
        ```
        OPENAI_API_KEY="your_api_key_here"
        ```

## How to Run the Service

Execute the `main.py` script from your terminal to start the FastAPI server using Uvicorn:

```bash
python main.py
```

You will see output indicating that the server is running, typically on `http://127.0.0.1:8000`.

```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

## How to Interact with the API

The easiest way to interact with the API is through the automatically generated documentation.

1.  **Open your web browser** and navigate to:
    [**http://127.0.0.1:8000/docs**](http://127.0.0.1:8000/docs)

2.  You will see the **FastAPI interactive documentation**.

3.  Click on the `/query-agent/` endpoint to expand it.

4.  Click the **"Try it out"** button.

5.  In the **Request body** field, enter your question in JSON format. For example:
    ```json
    {
      "question": "Which product category generated the most revenue?"
    }
    ```

6.  Click the **"Execute"** button.

7.  Scroll down to see the API's **response**, which will contain both your original question and the agent's final answer.

### Example Questions to Try

```json
{ "question": "What was the total revenue for all products?" }
```
```json
{ "question": "What were the top 3 best-selling products by units sold?" }
```
```json
{ "question": "Calculate the average unit price for each product category." }
```

### Using `curl` (Alternative)

You can also interact with the API from your command line using `curl`:

```bash
curl -X 'POST' \
  'http://127.0.0.1:8000/query-agent/' \
  -H 'Content-Type: application/json' \
  -d '{
    "question": "How many transactions are in the dataset?"
  }'
```

> **Security Warning**: This project uses Python's `exec()` function to run code generated by an LLM. This is for demonstration purposes in a controlled environment. Never expose this functionality to untrusted users on the internet without proper, robust sandboxing (e.g., running the code execution in a separate, isolated Docker container with strict resource limits).